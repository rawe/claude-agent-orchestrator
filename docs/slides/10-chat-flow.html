<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Message Flow - Agent Orchestrator</title>
  <style>
    :root {
      --color-bg: #0a0f1a;
      --color-bg-gradient: linear-gradient(135deg, #0a0f1a 0%, #1a1f35 100%);
      --color-bg-card: #141b2d;
      --color-coordinator: #3b82f6;
      --color-runner: #10b981;
      --color-dashboard: #f59e0b;
      --color-session: #8b5cf6;
      --color-executor: #ec4899;
      --color-text: #f1f5f9;
      --color-text-muted: #64748b;
      --color-text-bright: #ffffff;
      --color-border: #1e293b;
      --color-border-light: #334155;
      --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      --font-mono: 'SF Mono', monospace;
      --radius-md: 8px;
      --radius-lg: 12px;
      --radius-full: 9999px;
      --space-sm: 0.5rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      --transition-normal: 250ms ease;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; overflow: hidden; }
    body {
      font-family: var(--font-sans);
      background: var(--color-bg-gradient);
      color: var(--color-text);
      -webkit-font-smoothing: antialiased;
    }
    .slide {
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
      padding: var(--space-xl);
      position: relative;
    }
    .slide::before {
      content: '';
      position: absolute;
      top: -50%; left: -50%;
      width: 200%; height: 200%;
      background: radial-gradient(circle at 50% 50%, rgba(139, 92, 246, 0.06) 0%, transparent 50%);
      pointer-events: none;
    }
    .slide > * { position: relative; z-index: 1; }
    .slide-header { text-align: center; margin-bottom: var(--space-md); }
    .slide-header h1 {
      font-size: clamp(1.75rem, 4vw, 2.5rem);
      font-weight: 700;
      color: var(--color-text-bright);
      margin-bottom: 0.25rem;
    }
    .slide-header .subtitle {
      font-size: clamp(0.875rem, 1.5vw, 1rem);
      color: var(--color-text-muted);
    }
    .slide-content {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .slide-nav {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-lg);
      padding: var(--space-md) 0;
    }
    .slide-nav a {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 48px;
      height: 48px;
      border-radius: var(--radius-full);
      background: var(--color-bg-card);
      border: 1px solid var(--color-border-light);
      color: var(--color-text);
      text-decoration: none;
      font-size: 1.25rem;
      transition: all var(--transition-normal);
    }
    .slide-nav a:hover {
      background: #1e2844;
      border-color: var(--color-session);
      transform: translateY(-2px);
    }
    .slide-nav a.disabled { opacity: 0.3; pointer-events: none; }
    .slide-number { font-size: 0.875rem; color: var(--color-text-muted); min-width: 60px; text-align: center; }

    /* Sequence Diagram */
    .sequence-diagram {
      width: 100%;
      max-width: 950px;
      height: auto;
    }

    .lifeline {
      stroke: var(--color-border-light);
      stroke-width: 2;
      stroke-dasharray: 6 4;
    }

    .actor-box {
      fill: var(--color-bg-card);
      stroke-width: 2;
      rx: 8;
    }

    .actor-dashboard { stroke: var(--color-dashboard); }
    .actor-coordinator { stroke: var(--color-coordinator); }
    .actor-runner { stroke: var(--color-runner); }
    .actor-executor { stroke: var(--color-executor); }

    .actor-label {
      fill: var(--color-text-bright);
      font-size: 13px;
      font-weight: 600;
    }

    .actor-icon {
      font-size: 20px;
    }

    .message-arrow {
      stroke-width: 2;
      fill: none;
      marker-end: url(#seq-arrow);
    }

    .message-arrow-animated {
      stroke-dasharray: 8 4;
      animation: flowSeq 1s linear infinite;
    }

    @keyframes flowSeq {
      to { stroke-dashoffset: -12; }
    }

    .message-label {
      fill: var(--color-text);
      font-size: 11px;
    }

    .message-label-bg {
      fill: var(--color-bg);
    }

    .step-badge {
      fill: var(--color-session);
    }

    .step-badge-text {
      fill: white;
      font-size: 10px;
      font-weight: 700;
    }

    .activation-bar {
      fill: rgba(139, 92, 246, 0.3);
      stroke: var(--color-session);
      stroke-width: 1;
    }

    .response-arrow {
      stroke-dasharray: 4 3;
    }
  </style>
</head>
<body>
  <div class="slide">
    <header class="slide-header">
      <h1>Message Flow Sequence</h1>
      <p class="subtitle">Detailed view of a chat message lifecycle</p>
    </header>

    <main class="slide-content">
      <svg class="sequence-diagram" viewBox="0 0 950 480">
        <defs>
          <marker id="seq-arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#64748b" />
          </marker>
          <marker id="seq-arrow-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#10b981" />
          </marker>
        </defs>

        <!-- Actor boxes at top -->
        <g transform="translate(100, 20)">
          <rect class="actor-box actor-dashboard" x="-60" y="0" width="120" height="50"/>
          <text class="actor-label" x="0" y="32" text-anchor="middle">üìä Dashboard</text>
        </g>
        <g transform="translate(350, 20)">
          <rect class="actor-box actor-coordinator" x="-60" y="0" width="120" height="50"/>
          <text class="actor-label" x="0" y="32" text-anchor="middle">üß† Coordinator</text>
        </g>
        <g transform="translate(600, 20)">
          <rect class="actor-box actor-runner" x="-60" y="0" width="120" height="50"/>
          <text class="actor-label" x="0" y="32" text-anchor="middle">‚ö° Runner</text>
        </g>
        <g transform="translate(850, 20)">
          <rect class="actor-box actor-executor" x="-60" y="0" width="120" height="50"/>
          <text class="actor-label" x="0" y="32" text-anchor="middle">ü§ñ Claude</text>
        </g>

        <!-- Lifelines -->
        <line class="lifeline" x1="100" y1="70" x2="100" y2="460"/>
        <line class="lifeline" x1="350" y1="70" x2="350" y2="460"/>
        <line class="lifeline" x1="600" y1="70" x2="600" y2="460"/>
        <line class="lifeline" x1="850" y1="70" x2="850" y2="460"/>

        <!-- Activation bars -->
        <rect class="activation-bar" x="345" y="100" width="10" height="80"/>
        <rect class="activation-bar" x="595" y="200" width="10" height="180"/>
        <rect class="activation-bar" x="845" y="240" width="10" height="120"/>

        <!-- Step 1: Send message -->
        <circle class="step-badge" cx="40" cy="110" r="12"/>
        <text class="step-badge-text" x="40" y="114" text-anchor="middle">1</text>
        <line class="message-arrow message-arrow-animated" x1="100" y1="110" x2="340" y2="110" stroke="#f59e0b"/>
        <rect class="message-label-bg" x="170" y="92" width="80" height="16"/>
        <text class="message-label" x="210" y="104" text-anchor="middle">POST /chat</text>

        <!-- Step 2: Create session + agent run -->
        <circle class="step-badge" cx="40" cy="150" r="12"/>
        <text class="step-badge-text" x="40" y="154" text-anchor="middle">2</text>
        <rect x="355" y="130" width="90" height="40" rx="4" fill="#141b2d" stroke="#3b82f6"/>
        <text class="message-label" x="400" y="148" text-anchor="middle" fill="#3b82f6" font-size="9">Create Session</text>
        <text class="message-label" x="400" y="162" text-anchor="middle" fill="#3b82f6" font-size="9">Queue Run</text>

        <!-- Step 3: Long-poll picks up -->
        <circle class="step-badge" cx="40" cy="210" r="12"/>
        <text class="step-badge-text" x="40" y="214" text-anchor="middle">3</text>
        <line class="message-arrow message-arrow-animated" x1="590" y1="210" x2="360" y2="210" stroke="#10b981"/>
        <rect class="message-label-bg" x="430" y="192" width="70" height="16"/>
        <text class="message-label" x="465" y="204" text-anchor="middle">GET /runs</text>

        <line class="message-arrow message-arrow-animated" x1="360" y1="240" x2="590" y2="240" stroke="#3b82f6"/>
        <rect class="message-label-bg" x="430" y="222" width="70" height="16"/>
        <text class="message-label" x="465" y="234" text-anchor="middle">Agent Run</text>

        <!-- Step 4: Spawn executor -->
        <circle class="step-badge" cx="40" cy="280" r="12"/>
        <text class="step-badge-text" x="40" y="284" text-anchor="middle">4</text>
        <line class="message-arrow message-arrow-animated" x1="610" y1="280" x2="840" y2="280" stroke="#10b981"/>
        <rect class="message-label-bg" x="680" y="262" width="70" height="16"/>
        <text class="message-label" x="715" y="274" text-anchor="middle">Subprocess</text>

        <!-- Step 5: AI Processing -->
        <circle class="step-badge" cx="40" cy="320" r="12"/>
        <text class="step-badge-text" x="40" y="324" text-anchor="middle">5</text>
        <rect x="855" y="300" width="80" height="30" rx="4" fill="#141b2d" stroke="#ec4899"/>
        <text class="message-label" x="895" y="318" text-anchor="middle" fill="#ec4899" font-size="9">AI Thinking...</text>

        <!-- Step 6: Stream events -->
        <circle class="step-badge" cx="40" cy="370" r="12"/>
        <text class="step-badge-text" x="40" y="374" text-anchor="middle">6</text>
        <line class="message-arrow message-arrow-animated" x1="840" y1="350" x2="610" y2="350" stroke="#ec4899"/>
        <line class="message-arrow message-arrow-animated" x1="590" y1="370" x2="360" y2="370" stroke="#10b981"/>
        <line class="message-arrow message-arrow-animated" x1="340" y1="390" x2="110" y2="390" stroke="#3b82f6"/>
        <rect class="message-label-bg" x="180" y="372" width="90" height="16"/>
        <text class="message-label" x="225" y="384" text-anchor="middle">SSE: events</text>

        <!-- Step 7: Complete -->
        <circle class="step-badge" cx="40" cy="430" r="12"/>
        <text class="step-badge-text" x="40" y="434" text-anchor="middle">7</text>
        <line class="message-arrow response-arrow" x1="590" y1="430" x2="360" y2="430" stroke="#10b981" marker-end="url(#seq-arrow-green)"/>
        <rect class="message-label-bg" x="430" y="412" width="70" height="16"/>
        <text class="message-label" x="465" y="424" text-anchor="middle">Complete ‚úì</text>

        <!-- Legend -->
        <g transform="translate(30, 440)">
          <rect x="0" y="0" width="200" height="35" rx="6" fill="#141b2d" stroke="#1e293b"/>
          <line x1="15" y1="17" x2="45" y2="17" stroke="#64748b" stroke-width="2"/>
          <text x="55" y="21" fill="#94a3b8" font-size="9">Request</text>
          <line x1="105" y1="17" x2="135" y2="17" stroke="#64748b" stroke-width="2" stroke-dasharray="4 3"/>
          <text x="145" y="21" fill="#94a3b8" font-size="9">Response</text>
        </g>
      </svg>
    </main>

    <nav class="slide-nav">
      <a href="09-chat-overview.html" class="nav-prev">‚Üê</a>
      <a href="index.html" class="nav-home">‚åÇ</a>
      <span class="slide-number">10 / 21</span>
      <a href="11-parent-child.html" class="nav-next">‚Üí</a>
    </nav>
  </div>

  <script>
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') document.querySelector('.nav-prev:not(.disabled)')?.click();
      if (e.key === 'ArrowRight') document.querySelector('.nav-next:not(.disabled)')?.click();
      if (e.key === 'Home' || e.key === 'h') document.querySelector('.nav-home')?.click();
    });
  </script>
</body>
</html>
