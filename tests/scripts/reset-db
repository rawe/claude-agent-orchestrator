#!/bin/bash
# Reset the Agent Coordinator SQLite database for clean test runs.
#
# Usage:
#   ./tests/scripts/reset-db

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/../.." && pwd)"

# Database paths
COORDINATOR_DB="$PROJECT_ROOT/servers/agent-coordinator/.agent-orchestrator/observability.db"
TEST_EXECUTOR_DATA="$PROJECT_ROOT/servers/agent-runner/executors/test-executor/.test-executor-data"

echo "Resetting test environment..."

# Remove Agent Coordinator database
if [ -f "$COORDINATOR_DB" ]; then
    rm "$COORDINATOR_DB"
    echo "  Removed: $COORDINATOR_DB"
else
    echo "  (no database to remove)"
fi

# Remove test executor session data
if [ -d "$TEST_EXECUTOR_DATA" ]; then
    rm -rf "$TEST_EXECUTOR_DATA"
    echo "  Removed: $TEST_EXECUTOR_DATA"
else
    echo "  (no test executor data to remove)"
fi

echo "Done. Test environment is clean."
