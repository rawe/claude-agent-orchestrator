#!/bin/bash
# Start Agent Runner with environment variables from .env
#
# Usage:
#   ./tests/scripts/start-runner [profile]
#
# Arguments:
#   profile  - Executor profile: test-executor (default) or claude-code
#
# The script:
#   - Sources .env and exports all variables
#   - Starts the runner with the specified profile

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/../.." && pwd)"

PROFILE="${1:-test-executor}"

# Source and export all variables from .env
if [ -f "$PROJECT_ROOT/.env" ]; then
    set -a
    source "$PROJECT_ROOT/.env"
    set +a
else
    echo "ERROR: .env file not found at $PROJECT_ROOT/.env" >&2
    exit 1
fi

# Start runner with profile
exec "$PROJECT_ROOT/servers/agent-runner/agent-runner" -x "$PROFILE"
