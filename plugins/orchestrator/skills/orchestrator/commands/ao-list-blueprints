#!/usr/bin/env -S uv run --script
# /// script
# requires-python = ">=3.11"
# dependencies = [
#     "typer",
# ]
# ///
"""
List all available agent blueprints from Agent Orchestrator API.

Configuration:
    AGENT_ORCHESTRATOR_API_URL: API base URL (default: http://localhost:8765)
"""

import sys
from pathlib import Path

sys.path.insert(0, str(Path(__file__).parent / "lib"))

import typer
from agent_api import list_agents_api, AgentAPIError

app = typer.Typer(add_completion=False)


@app.command()
def main(
    context: str = typer.Option(
        "internal",
        "--context", "-c",
        help="Visibility context: 'external' (public agents) or 'internal' (worker agents). Default: internal"
    )
):
    """
    List all available agent blueprints filtered by visibility context.

    Displays: agent name, description

    When called from within the orchestrator framework, defaults to 'internal'
    context which shows worker/specialist agents (internal + all visibility).

    Examples:
        ao-list-blueprints                    # List internal agents (default)
        ao-list-blueprints --context external # List public agents
        ao-list-blueprints -c internal        # List internal agents
    """
    try:
        agents = list_agents_api(context=context)
    except AgentAPIError as e:
        print(f"Error: {e}", file=sys.stderr)
        sys.exit(1)

    if not agents:
        print(f"No agent blueprints found for context '{context}'")
        return

    # Display agents
    first = True
    for agent in agents:
        if first:
            first = False
        else:
            print("---")
            print()

        name = agent.get("name", "unknown")
        description = agent.get("description", "")

        print(f"{name}:")
        print(description)
        print()


if __name__ == "__main__":
    app()
