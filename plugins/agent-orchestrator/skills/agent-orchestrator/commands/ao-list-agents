#!/usr/bin/env -S uv run --script
# /// script
# requires-python = ">=3.11"
# dependencies = [
#     "typer",
# ]
# ///
"""
List all available agent definitions from Agent Manager API.
"""

import sys
from pathlib import Path

sys.path.insert(0, str(Path(__file__).parent / "lib"))

import typer
from typing import Optional
from agent_api import list_agents_api, AgentAPIError

app = typer.Typer(add_completion=False)


@app.command()
def main(
    api_url: Optional[str] = typer.Option(
        None,
        "--api-url",
        envvar="AGENT_ORCHESTRATOR_AGENT_API_URL",
        help="Agent Manager API URL (default: http://localhost:8767)",
    ),
):
    """
    List all available agent definitions.

    Displays: agent name, description, status

    Examples:
        ao-list-agents
        ao-list-agents --api-url http://localhost:8767
    """
    # Set API URL if provided via flag
    if api_url:
        import os
        os.environ["AGENT_ORCHESTRATOR_AGENT_API_URL"] = api_url

    try:
        agents = list_agents_api()
    except AgentAPIError as e:
        print(f"Error: {e}", file=sys.stderr)
        sys.exit(1)

    if not agents:
        print("No agent definitions found")
        return

    # Display agents
    first = True
    for agent in agents:
        if first:
            first = False
        else:
            print("---")
            print()

        name = agent.get("name", "unknown")
        description = agent.get("description", "")
        status = agent.get("status", "active")

        status_indicator = "" if status == "active" else " [inactive]"
        print(f"{name}{status_indicator}:")
        print(description)
        print()


if __name__ == "__main__":
    app()
